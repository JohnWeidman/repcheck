{% extends "base.html" %}
{% block content %}
    <div class="m-10 card bg-zinc-200 rounded-lg drop-shadow-xl shadow-black">
        <div class="flex justify-center items-center">
            <h1 class="text-3xl mt-24 font-bold md:text-5xl m-2 text-nowrap">Welcome to Congress</h1>
        </div>
        <section class="flex flex-wrap items-center justify-center mx-auto p-4 gap-10 rounded-lg">
            <div class="md:m-8 p-4 rounded-lg  bg-zinc-200 border-2 border-base-200 shadow-xl hover:shadow-2xl transition-shadow duration-300 sm:max-w-full text-center justify-self-center items-center mx-auto">
                <div class="drop-shadow-xl shadow-black">
                    <h2 class="text-4xl font-bold p-4">Current Congress</h2>
                    <h2 class="text-2xl font-bold p-4">Select a Chamber</h2>
                    {% comment %}
                    Make it so that the buttons are the color that corresponds
                    to the party that has a majority in each branch
                    {% endcomment %}
                    <div class="flex justify-center items-center gap-4">
                        <button hx-get="{% url 'house' %}"
                                hx-target="#content"
                                hx-push-url="true"
                                hx-vals='js:{"congress": 119}'
                                class="btn btn-accent btn-lg">
                            <span class="text-2xl text-black">House</span>
                        </button>
                        <button hx-get="{% url 'senate' %}"
                                hx-target="#content"
                                hx-push-url="true"
                                hx-vals='js:{"congress": 119}'
                                class="btn btn-accent btn-lg">
                            <span class="text-2xl text-black">Senate</span>
                        </button>
                    </div>
                </div>
            </div>
            <div class="md:m-8 p-4 rounded-lg bg-zinc-200 border-2 border-base-200 shadow-xl hover:shadow-2xl transition-shadow duration-300 sm:max-w-full text-center justify-self-center items-center mx-auto">
                <div class="drop-shadow-xl shadow-black">
                    <h2 class="text-4xl font-bold p-4">Historical Congresses</h2>
                    <div class="flex justify-center items-center p-4">
                        <form id="congress_select">
                            <select class="select select-bordered bg-secondary select-lg w-full max-w-xs"
                                    name="congress"
                                    id="congress"
                                    required>
                                <option class="justify-center" value="">Select a Congress</option>
                                {% for congress in congresses %}
                                    {% if not forloop.first %}
                                        <option class="justify-center" value="{{ congress.id }}">
                                            #{{ congress.congress_number }} | {{ congress.start_date|date:"Y" }}
                                        </option>
                                    {% endif %}
                                {% endfor %}
                            </select>
                        </form>
                    </div>
                    <h2 class="text-2xl font-bold p-4">Select a Chamber</h2>
                    <div class="flex justify-center items-center gap-4">
                        <button onclick="validateAndNavigate('house')" class="btn btn-accent btn-lg">
                            <span class="text-2xl text-black">House</span>
                        </button>
                        <button onclick="validateAndNavigate('senate')" class="btn btn-accent btn-lg">
                            <span class="text-2xl text-black">Senate</span>
                        </button>
                    </div>
                </div>
            </div>
            <div class="md:m-8 p-4 rounded-lg  bg-zinc-200 border-2 border-base-200 shadow-xl hover:shadow-2xl transition-shadow duration-300 sm:max-w-full md:w-1/2 w-full text-center mx-auto">
                <div class="flex flex-col justify-center items-center gap-10 p-4">
                    <h2 class="text-4xl font-bold">Live Proceedings</h2>
                    <div class="flex md:flex-row flex-col justify-center items-center h-full gap-10 p-4">
                        <button class="btn btn-primary btn-lg">
                            <a href="https://live.house.gov/" target="_blank">Live House Proceedings</a>
                        </button>
                        <button class="btn btn-primary btn-lg">
                            <a href="https://www.senate.gov/legislative/floor_activity_pail.htm"
                               target="_blank">Live Senate Proceedings</a>
                        </button>
                    </div>
                </div>
            </div>
        </div>
    </section>
    <div id="alert-container"
         class="fixed top-4 left-1/2 transform -translate-x-1/2 z-50"></div>
    <script>
function validateAndNavigate(filterType) {
    const congressSelect = document.getElementById('congress');
    const selectedCongress = congressSelect.value;
    
    if (!selectedCongress) {
        showAlert('Please select a Congress before proceeding.');
        return;
    }
    
    const url = filterType === 'house' ? '{% url "house" %}' : '{% url "senate" %}';
    htmx.ajax('GET', `${url}?congress=${selectedCongress}`, {
        target: '#content',
        swap: 'innerHTML'
    });
    
    history.pushState({page: filterType, congress: selectedCongress}, '', `${url}?congress=${selectedCongress}`);
}

function showAlert(message) {
    const alertContainer = document.getElementById('alert-container');
    
    alertContainer.innerHTML = '';
    
    const alertHTML = `
        <div class="alert alert-error shadow-lg max-w-md">
            <div>
                <span class="mr-2 text-center">${message}</span>
            </div>
            <div class="fixed md:top-3 top-0 right-0">
                <button onclick="closeAlert()" class="btn btn-sm btn-ghost">âœ•</button>
            </div>
        </div>
    `;
    
    alertContainer.innerHTML = alertHTML;
    setTimeout(closeAlert, 5000);
}

function closeAlert() {
    const alertContainer = document.getElementById('alert-container');
    alertContainer.innerHTML = '';
}

window.addEventListener('popstate', function(event) {
    window.location.reload();
});

window.addEventListener('load', function() {
    history.replaceState({page: 'congress'}, '', window.location.href);
});
    </script>
{% endblock content %}
