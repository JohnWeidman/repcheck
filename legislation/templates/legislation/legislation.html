{% extends "base.html" %}
{% block content %}
  <div class="flex items-center justify-center mx-auto p-4 gap-10 rounded-lg">
    <div class="bg-zinc-200 border-base-200 border-2 rounded-lg p-12 shadow-xl hover:shadow-2xl transition-shadow duration-300">
      <h1 class="text-3xl md:text-4xl mt-6 font-bold text-center">Current Congress</h1>
      <p>Explore the bills and laws  <br> being worked on by the 119th Congress</p>
      <div class="md:flex justify-center items-center md:gap-4 p-4">
        <button hx-get="{% url 'bills' %}"
                hx-target="#content"
                hx-push-url="true"
                hx-vals='js:{"congress": 119}'
                class="btn btn-accent btn-lg">
          <span class="text-2xl text-black">Bills</span>
        </button>
        <button hx-get="{% url 'laws' %}"
                hx-target="#content"
                hx-push-url="true"
                hx-vals='js:{"congress": 119}'
                class="btn btn-accent btn-lg">
          <span class="text-2xl text-black">Laws</span>
        </button>
      </div>
    </div>
    <div class="bg-zinc-200 border-base-200 border-2 rounded-lg px-12 shadow-xl hover:shadow-2xl transition-shadow duration-300">
      <h1 class="text-3xl md:text-4xl mt-6 font-bold text-center">Historical Congresses</h1>
      <p>Explore the bills and laws from previous Congresses</p>
      <div class="flex justify-center items-center gap-10 p-4">
        <form id="congress_select">
          <select class="select select-bordered bg-secondary select-lg w-full max-w-xs"
                  name="congress"
                  id="congress">
            <option class="justify-center" value="">Select a Congress</option>
            {% for congress in congresses %}
              {% if not forloop.first %}
                <option class="justify-center" value="{{ congress.id }}">
                  #{{ congress.congress_number }} | {{ congress.start_date|date:"Y" }}
                </option>
              {% endif %}
            {% endfor %}
          </select>
        </form>
      </div>
      <div class="md:flex justify-center items-center md:gap-4 p-4">
        <button onclick="validateAndNavigate('bills')" class="btn btn-accent btn-lg">
          <span class="text-2xl text-black">Bills</span>
        </button>
        <button onclick="validateAndNavigate('laws')" class="btn btn-accent btn-lg">
          <span class="text-2xl text-black">Laws</span>
        </button>
      </div>
    </div>
  </div>
  <div id="alert-container"
       class="fixed top-4 left-1/2 transform -translate-x-1/2 z-50"></div>
  <script>
function validateAndNavigate(filterType) {
    const congressSelect = document.getElementById('congress');
    const selectedCongress = congressSelect.value;
    
    if (!selectedCongress) {
        showAlert('Please select a Congress before proceeding.');
        return;
    }
    
    const url = filterType === 'bills' ? '{% url "bills" %}' : '{% url "laws" %}';
    htmx.ajax('GET', `${url}?congress=${selectedCongress}`, {
        target: '#content',
        swap: 'innerHTML'
    });
    
    history.pushState({page: filterType, congress: selectedCongress}, '', `${url}?congress=${selectedCongress}`);
}

function showAlert(message) {
    const alertContainer = document.getElementById('alert-container');
    
    alertContainer.innerHTML = '';
    
    const alertHTML = `
        <div class="alert alert-error shadow-lg mb-4 max-w-md">
            <div>
                <span>${message}</span>
            </div>
            <div class="flex-none">
                <button onclick="closeAlert()" class="btn btn-sm btn-ghost">âœ•</button>
            </div>
        </div>
    `;
    
    alertContainer.innerHTML = alertHTML;
    setTimeout(closeAlert, 5000);
}

function closeAlert() {
    const alertContainer = document.getElementById('alert-container');
    alertContainer.innerHTML = '';
}

window.addEventListener('popstate', function(event) {
    window.location.reload();
});

window.addEventListener('load', function() {
    history.replaceState({page: 'legislation'}, '', window.location.href);
});
  </script>
{% endblock content %}
